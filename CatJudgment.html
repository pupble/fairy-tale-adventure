<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI çŒ«çŒ«æ³•åº­ | DeepSeek å¼ºåŠ›é©±åŠ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <!-- Markdown è§£æåº“ï¼Œç”¨äºæ¸²æŸ“ AI çš„å›å¤ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #FFF0F3;
            background-image: radial-gradient(#FFC4D6 2px, transparent 2px);
            background-size: 24px 24px;
        }
        .cute-font { font-family: 'ZCOOL KuaiLe', cursive; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            box-shadow: 0 20px 40px -5px rgba(255, 107, 129, 0.2);
            border: 4px solid #FFF;
        }
        .input-group { transition: all 0.3s ease; }
        .input-group:focus-within { transform: scale(1.01); border-color: #F472B6; box-shadow: 0 0 15px rgba(244, 114, 182, 0.2); }
        
        /* éšè—æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* åŠ¨ç”»ç±» */
        .pop-enter { animation: popEnter 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes popEnter { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        
        .cat-thinking { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- ä¸»å®¹å™¨ -->
    <div class="w-full max-w-5xl glass-panel rounded-[3rem] relative min-h-[700px] flex flex-col overflow-hidden pop-enter">
        
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="bg-gradient-to-r from-pink-100 to-rose-100 p-5 flex items-center justify-between px-8 border-b border-pink-200 z-50">
            <button onclick="goBack()" id="btn-back" class="hidden text-pink-500 hover:bg-white/50 px-4 py-2 rounded-full font-bold transition">
                <i class="fa-solid fa-arrow-left mr-2"></i>è¿”å›ä¿®æ”¹
            </button>
            <div class="flex-1 text-center">
                <h1 class="text-3xl text-pink-600 cute-font tracking-widest drop-shadow-sm">
                    <i class="fa-solid fa-cat mr-2"></i>AI çŒ«çŒ«æ³•åº­
                </h1>
                <p class="text-xs text-pink-400 font-bold tracking-wide">DeepSeek V3 æ™ºæ…§åŠ æŒ</p>
            </div>
            <button onclick="toggleSettings()" class="text-pink-400 hover:text-pink-600 transition">
                <i class="fa-solid fa-gear text-xl"></i>
            </button>
        </header>

        <!-- API è®¾ç½®é¢æ¿ (éšè—) -->
        <div id="settings-panel" class="hidden absolute top-20 right-8 z-50 bg-white p-4 rounded-2xl shadow-xl border border-pink-100 w-80">
            <h3 class="text-sm font-bold text-gray-600 mb-2">API è®¾ç½®</h3>
            <input type="password" id="api-key-input" class="w-full bg-gray-50 border rounded-lg p-2 text-xs mb-2 outline-none focus:ring-2 ring-pink-300" placeholder="è¾“å…¥ DeepSeek API Key">
            <div class="flex justify-between items-center">
                <span class="text-xs text-gray-400">é»˜è®¤å·²é¢„å¡«æµ‹è¯•Key</span>
                <button onclick="saveSettings()" class="bg-pink-500 text-white px-3 py-1 rounded-lg text-xs">ä¿å­˜</button>
            </div>
        </div>

        <main class="flex-1 relative overflow-hidden">
            
            <!-- 1. é¦–é¡µ Landing -->
            <div id="view-landing" class="h-full flex flex-col items-center justify-center text-center p-8 space-y-8 absolute inset-0 transition-transform duration-500">
                <div class="relative group">
                    <div class="absolute -inset-4 bg-gradient-to-tr from-pink-300 to-purple-300 rounded-full blur-lg opacity-40 group-hover:opacity-70 transition duration-700 animate-pulse"></div>
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=JudgeKitty&backgroundColor=ffdfbf&clothing=collar&eyes=happy&mouth=smile&top=hat" 
                         alt="Cat Judge" 
                         class="relative w-56 h-56 drop-shadow-2xl hover:-rotate-6 transition-transform duration-300">
                    <div class="absolute -bottom-6 right-0 bg-white text-pink-600 px-4 py-2 rounded-full text-sm font-bold shadow-lg border-2 border-pink-100 transform rotate-12">
                        æœ¬å–µåªè¯´çœŸè¯ï¼
                    </div>
                </div>
                
                <div class="space-y-4 max-w-xl">
                    <h2 class="text-4xl cute-font text-gray-800">æƒ…ä¾£åµæ¶ï¼Ÿè®© AI æ¥åˆ¤ï¼</h2>
                    <p class="text-gray-500 text-lg">åˆ«å†äº‰è°å¯¹è°é”™äº†ï¼ŒæŠŠâ€œå®¢è§‚äº‹å®â€å’Œâ€œä¸»è§‚å§”å±ˆâ€éƒ½äº¤ç»™æˆ‘ã€‚<br>DeepSeek å¤§è„‘å°†ä¸ºæ‚¨è¿›è¡Œ <span class="text-pink-500 font-bold">100% å…¬æ­£åˆæ‰å¿ƒ</span> çš„è£å†³ã€‚</p>
                </div>

                <button onclick="switchView('view-form')" class="px-12 py-5 bg-gradient-to-r from-pink-500 to-rose-500 rounded-2xl text-white font-bold text-2xl shadow-xl shadow-pink-200 hover:shadow-pink-400 hover:-translate-y-1 transition-all active:scale-95">
                    <i class="fa-solid fa-gavel mr-3"></i>å‡å ‚ï¼
                </button>
            </div>

            <!-- 2. æ¡ˆæƒ…å½•å…¥ Form -->
            <div id="view-form" class="h-full flex flex-col p-6 absolute inset-0 translate-x-full transition-transform duration-500 bg-white/50 overflow-y-auto no-scrollbar">
                <!-- é¢„è®¾æ¡ˆä¾‹æŒ‰é’® -->
                <div class="flex justify-center gap-3 mb-6 flex-wrap">
                    <button onclick="fillCase('snack')" class="bg-orange-100 text-orange-600 px-4 py-2 rounded-full text-sm font-bold hover:bg-orange-200 transition">ğŸ¬ å·åƒé›¶é£Ÿæ¡ˆ</button>
                    <button onclick="fillCase('photo')" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-full text-sm font-bold hover:bg-blue-200 transition">ğŸ“¸ æ‹ç…§å¤ªä¸‘æ¡ˆ</button>
                    <button onclick="fillCase('msg')" class="bg-purple-100 text-purple-600 px-4 py-2 rounded-full text-sm font-bold hover:bg-purple-200 transition">ğŸ’¬ å›æ¶ˆæ¯æ…¢æ¡ˆ</button>
                </div>

                <div class="flex flex-col md:flex-row gap-6 pb-24">
                    <!-- Jimmy Side -->
                    <div class="flex-1 bg-white rounded-3xl p-6 border-2 border-blue-100 shadow-sm input-group relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-blue-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                        <div class="relative z-10">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-10 h-10 bg-blue-500 text-white rounded-xl flex items-center justify-center font-bold text-lg">J</div>
                                <input id="name-male" type="text" value="Jimmy" class="text-xl font-bold text-gray-700 bg-transparent outline-none w-full border-b-2 border-transparent focus:border-blue-300 transition" placeholder="ç”·ç”Ÿåå­—">
                            </div>
                            
                            <label class="block text-xs font-bold text-blue-400 uppercase mb-2">ğŸ¤” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ(å®¢è§‚äº‹å®)</label>
                            <textarea id="fact-male" class="w-full h-24 p-3 bg-blue-50/50 rounded-xl text-sm text-gray-600 outline-none resize-none mb-4 focus:bg-white border border-transparent focus:border-blue-200 transition" placeholder="ä¾‹å¦‚ï¼šæˆ‘ä¹°äº†ä¸€æ¯å¥¶èŒ¶è‡ªå·±å–äº†..."></textarea>
                            
                            <label class="block text-xs font-bold text-blue-400 uppercase mb-2">ğŸ˜­ ä½ çš„å§”å±ˆç‚¹ï¼Ÿ(ä¸»è§‚æ„Ÿå—)</label>
                            <textarea id="feel-male" class="w-full h-24 p-3 bg-blue-50/50 rounded-xl text-sm text-gray-600 outline-none resize-none focus:bg-white border border-transparent focus:border-blue-200 transition" placeholder="ä¾‹å¦‚ï¼šæˆ‘è§‰å¾—å¥¹å¹³æ—¶ä¹Ÿä¸çˆ±å–è¿™ä¸ªï¼Œè€Œä¸”æˆ‘å¤ªæ¸´äº†..."></textarea>
                        </div>
                    </div>

                    <!-- Linda Side -->
                    <div class="flex-1 bg-white rounded-3xl p-6 border-2 border-pink-100 shadow-sm input-group relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-pink-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                        <div class="relative z-10">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-10 h-10 bg-pink-500 text-white rounded-xl flex items-center justify-center font-bold text-lg">L</div>
                                <input id="name-female" type="text" value="Linda" class="text-xl font-bold text-gray-700 bg-transparent outline-none w-full border-b-2 border-transparent focus:border-pink-300 transition" placeholder="å¥³ç”Ÿåå­—">
                            </div>
                            
                            <label class="block text-xs font-bold text-pink-400 uppercase mb-2">ğŸ¤” å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ(å®¢è§‚äº‹å®)</label>
                            <textarea id="fact-female" class="w-full h-24 p-3 bg-pink-50/50 rounded-xl text-sm text-gray-600 outline-none resize-none mb-4 focus:bg-white border border-transparent focus:border-pink-200 transition" placeholder="ä¾‹å¦‚ï¼šçœ‹åˆ°ä»–è‡ªå·±å–å¥¶èŒ¶ï¼Œé—®éƒ½æ²¡é—®æˆ‘..."></textarea>
                            
                            <label class="block text-xs font-bold text-pink-400 uppercase mb-2">ğŸ˜­ ä½ çš„å§”å±ˆç‚¹ï¼Ÿ(ä¸»è§‚æ„Ÿå—)</label>
                            <textarea id="feel-female" class="w-full h-24 p-3 bg-pink-50/50 rounded-xl text-sm text-gray-600 outline-none resize-none focus:bg-white border border-transparent focus:border-pink-200 transition" placeholder="ä¾‹å¦‚ï¼šä¸åœ¨ä¹å¥¶èŒ¶ï¼Œåœ¨ä¹çš„æ˜¯ä»–å¿ƒé‡Œæœ‰æ²¡æœ‰æˆ‘ï¼"></textarea>
                        </div>
                    </div>
                </div>

                <div class="absolute bottom-8 left-0 right-0 flex justify-center z-20">
                    <button onclick="submitToAI()" class="group relative px-10 py-4 bg-gray-900 text-white rounded-full font-bold shadow-2xl hover:scale-105 transition-all overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-500 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                        <span class="relative flex items-center gap-2">
                            è¯·æ±‚ AI çŒ«çŒ«åˆ¤å†³ <i class="fa-solid fa-paper-plane"></i>
                        </span>
                    </button>
                </div>
            </div>

            <!-- 3. AI æ€è€ƒä¸­ Loading -->
            <div id="view-loading" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white/80 backdrop-blur-sm z-50">
                <div class="cat-thinking mb-8">
                    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" class="w-40 h-40 rounded-full border-8 border-pink-100 shadow-xl object-cover">
                </div>
                <h3 class="text-2xl cute-font text-gray-800 mb-2" id="loading-text">æ­£åœ¨è¿æ¥ DeepSeek æ˜Ÿçƒ...</h3>
                <div class="w-64 h-2 bg-gray-100 rounded-full overflow-hidden">
                    <div class="h-full bg-pink-500 animate-progress" style="width: 50%"></div>
                </div>
                <p class="text-xs text-gray-400 mt-4 font-mono" id="ai-log">> åˆå§‹åŒ–ç¥ç»ç½‘ç»œ...</p>
                <style>@keyframes animate-progress { 0% { width: 0; } 50% { width: 70%; } 100% { width: 100%; } }</style>
            </div>

            <!-- 4. åˆ¤å†³ç»“æœ Result -->
            <div id="view-result" class="h-full flex flex-col p-6 absolute inset-0 translate-x-full transition-transform duration-500 bg-white/60 overflow-y-auto no-scrollbar">
                
                <!-- æ¡ˆä»¶æ ‡é¢˜ -->
                <div class="text-center mb-6">
                    <span class="bg-pink-100 text-pink-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest">Case Closed</span>
                    <h2 id="result-title" class="text-3xl cute-font text-gray-800 mt-2">æ¡ˆä»¶æ ‡é¢˜åŠ è½½ä¸­...</h2>
                </div>

                <!-- è´£ä»»æ¯”ä¾‹æ¡ -->
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-white mb-6">
                    <div class="flex justify-between text-xs font-bold text-gray-400 mb-2 uppercase">
                        <span id="label-male">Jimmy</span>
                        <span>é”…æ˜¯è°çš„ï¼Ÿ</span>
                        <span id="label-female">Linda</span>
                    </div>
                    <div class="relative h-12 w-full bg-gray-100 rounded-full overflow-hidden flex font-bold text-white text-lg shadow-inner">
                        <div id="bar-male" class="bg-blue-400 flex items-center justify-center transition-all duration-1000" style="width: 50%">50%</div>
                        <div id="bar-female" class="bg-pink-400 flex items-center justify-center transition-all duration-1000" style="width: 50%">50%</div>
                        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-full w-10 h-10 flex items-center justify-center text-yellow-500 shadow-sm border-2 border-gray-50 z-10">
                            <i class="fa-solid fa-bolt"></i>
                        </div>
                    </div>
                </div>

                <!-- AI åˆ†æå†…å®¹ -->
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <!-- æ·±åº¦åˆ†æ -->
                    <div class="bg-white/80 p-5 rounded-2xl border border-pink-50 shadow-sm">
                        <h3 class="flex items-center gap-2 text-pink-600 font-bold mb-3">
                            <i class="fa-solid fa-microscope"></i> çŒ«çœ¼é€è§† (æ·±åº¦åˆ†æ)
                        </h3>
                        <div id="result-analysis" class="text-sm text-gray-600 leading-relaxed text-justify markdown-body">
                            <!-- AI å†…å®¹å¡«å…¥å¤„ -->
                        </div>
                    </div>

                    <!-- å¼ºåˆ¶æ‰§è¡Œ -->
                    <div class="bg-yellow-50/80 p-5 rounded-2xl border border-yellow-100 shadow-sm">
                        <h3 class="flex items-center gap-2 text-yellow-700 font-bold mb-3">
                            <i class="fa-solid fa-clipboard-list"></i> å¼ºåˆ¶å’Œè§£æ¸…å•
                        </h3>
                        <ul id="result-tasks" class="space-y-3">
                            <!-- AI ä»»åŠ¡å¡«å…¥å¤„ -->
                        </ul>
                    </div>
                </div>

                <!-- åº•éƒ¨æŒ‰é’® -->
                <div class="flex justify-center pb-8">
                    <button onclick="switchView('view-restore')" class="px-8 py-3 bg-pink-500 text-white rounded-full font-bold shadow-lg hover:bg-pink-600 transition hover:-translate-y-1">
                        å»æ‰§è¡Œä»»åŠ¡å¹¶å’Œå¥½ <i class="fa-solid fa-heart ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- 5. æ„Ÿæƒ…ä¿®å¤ (æ¸©åº¦è®¡) -->
            <div id="view-restore" class="h-full flex flex-col items-center justify-center p-6 absolute inset-0 translate-x-full transition-transform duration-500 bg-white/90">
                <h2 class="text-3xl cute-font text-gray-800 mb-2">ğŸ’– çˆ±æƒ…å›æ¸©ä»ª</h2>
                <p class="text-gray-400 text-sm mb-8">åˆ«ç”Ÿæ°”äº†ï¼Œç»™ä¸ªå°é˜¶ä¸‹å§ï¼</p>

                <div class="relative w-24 h-80 bg-gray-200 rounded-full border-4 border-white shadow-inner flex flex-col justify-end overflow-hidden mb-8">
                    <div id="liquid" class="w-full bg-blue-400 transition-all duration-700 relative" style="height: 30%">
                        <div class="absolute w-full h-full opacity-30 bg-white animate-pulse"></div>
                    </div>
                    <!-- åˆ»åº¦ -->
                    <div class="absolute top-1/4 w-full h-0.5 bg-gray-300 opacity-50"></div>
                    <div class="absolute top-2/4 w-full h-0.5 bg-gray-300 opacity-50"></div>
                    <div class="absolute top-3/4 w-full h-0.5 bg-gray-300 opacity-50"></div>
                </div>

                <div id="temp-val" class="text-5xl font-black text-blue-400 cute-font mb-6 transition-colors">30Â°C</div>

                <div class="flex gap-4">
                    <button onclick="addHeat(20)" class="bg-white border-2 border-pink-100 px-4 py-2 rounded-xl hover:bg-pink-50 transition active:scale-95 shadow-sm">
                        ğŸ¤ æ¡æ‰‹è¨€å’Œ
                    </button>
                    <button onclick="addHeat(30)" class="bg-white border-2 border-pink-100 px-4 py-2 rounded-xl hover:bg-pink-50 transition active:scale-95 shadow-sm">
                        ğŸ«‚ æŠ±æŠ±30ç§’
                    </button>
                    <button onclick="addHeat(40)" class="bg-white border-2 border-pink-100 px-4 py-2 rounded-xl hover:bg-pink-50 transition active:scale-95 shadow-sm">
                        ğŸ˜˜ äº²äº²ä¸€ä¸‹
                    </button>
                </div>
                
                <button onclick="resetApp()" class="mt-12 text-gray-400 hover:text-pink-500 text-sm underline">å†åˆ¤ä¸€ä¸ªæ¡ˆå­</button>
            </div>

        </main>
    </div>

    <!-- æ ¸å¿ƒé€»è¾‘è„šæœ¬ -->
    <script>
        // === å…¨å±€é…ç½® ===
        // ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œé¢„å¡«äº†æ‚¨æä¾›çš„Keyã€‚
        // åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ä¸è¦å°†Keyç›´æ¥æš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­ã€‚
        let DEEPSEEK_API_KEY = "sk-9bc8bb993b684218803e58cdeac07d12"; 
        const API_URL = "https://api.deepseek.com/chat/completions";

        // === ç•Œé¢å¯¼èˆªé€»è¾‘ ===
        const views = ['view-landing', 'view-form', 'view-result', 'view-restore'];
        let currentViewIndex = 0;

        function switchView(viewId) {
            const landing = document.getElementById('view-landing');
            const form = document.getElementById('view-form');
            const result = document.getElementById('view-result');
            const restore = document.getElementById('view-restore');
            const btnBack = document.getElementById('btn-back');

            // ç®€å•çš„è·¯ç”±é€»è¾‘
            if(viewId === 'view-landing') {
                landing.style.transform = 'translateX(0)';
                form.style.transform = 'translateX(100%)';
                result.style.transform = 'translateX(100%)';
                restore.style.transform = 'translateX(100%)';
                btnBack.classList.add('hidden');
            } else if (viewId === 'view-form') {
                landing.style.transform = 'translateX(-100%)';
                form.style.transform = 'translateX(0)';
                result.style.transform = 'translateX(100%)';
                restore.style.transform = 'translateX(100%)';
                btnBack.classList.remove('hidden');
            } else if (viewId === 'view-result') {
                result.style.transform = 'translateX(0)';
                restore.style.transform = 'translateX(100%)';
            } else if (viewId === 'view-restore') {
                restore.style.transform = 'translateX(0)';
            }
        }

        function goBack() {
            switchView('view-landing');
        }
        
        function resetApp() {
            document.getElementById('liquid').style.height = '30%';
            currentHeat = 30;
            switchView('view-form');
        }

        // === é¢„è®¾æ¡ˆä¾‹ ===
        const presets = {
            snack: { j_fact: "æˆ‘ä¹°äº†ä¸€åŒ…è–¯ç‰‡è‡ªå·±åƒå®Œäº†ã€‚", j_feel: "æˆ‘å½“æ—¶å¤ªé¥¿äº†ï¼Œè€Œä¸”å¹³æ—¶æˆ‘ä¹Ÿç»™å¥¹ä¹°å¾ˆå¤šã€‚", l_fact: "ä»–åƒç‹¬é£Ÿï¼Œé—®éƒ½æ²¡é—®æˆ‘ã€‚", l_feel: "ä¸åœ¨ä¹è–¯ç‰‡ï¼Œåœ¨ä¹çš„æ˜¯è¢«å¿½ç•¥çš„æ„Ÿè§‰ã€‚" },
            photo: { j_fact: "å¥¹è®©æˆ‘æ‹ç…§ï¼Œæˆ‘æ‹äº†50å¼ ï¼Œå¥¹éƒ½è¯´ä¸‘ã€‚", j_feel: "æˆ‘è§‰å¾—å¾ˆçœŸå®å•Šï¼Œå…‰çº¿ä¹Ÿåˆšå¥½ï¼Œå¥¹éè¦ä¿®å›¾é‚£æ ·çš„ã€‚", l_fact: "æŠŠæˆ‘æ‹å¾—åƒä¸€ç±³äº”ï¼Œå…¨æ˜¯åŒä¸‹å·´ã€‚", l_feel: "ä»–æ ¹æœ¬ä¸ç”¨å¿ƒï¼Œæ•·è¡äº†äº‹ã€‚" },
            msg:   { j_fact: "æˆ‘åœ¨æ‰“æ¸¸æˆå›¢æˆ˜ï¼Œæ²¡å›å¾®ä¿¡ã€‚", j_feel: "é‚£æ˜¯æ’ä½æ™‹çº§èµ›å•Šï¼æˆ‘å°±æ™šå›äº†10åˆ†é’Ÿã€‚", l_fact: "å¤±è¸ªäº†ä¸¤å°æ—¶ï¼Œå‘æ¶ˆæ¯ä¸å›ã€‚", l_feel: "æ‰‹æœºå°±åœ¨æ—è¾¹ä¸ºä»€ä¹ˆä¸çœ‹ï¼Ÿæ˜¯ä¸æ˜¯ä¸çˆ±äº†ï¼Ÿ" }
        };

        function fillCase(type) {
            const p = presets[type];
            document.getElementById('fact-male').value = p.j_fact;
            document.getElementById('feel-male').value = p.j_feel;
            document.getElementById('fact-female').value = p.l_fact;
            document.getElementById('feel-female').value = p.l_feel;
        }

        // === AI æ ¸å¿ƒäº¤äº’é€»è¾‘ ===
        async function submitToAI() {
            const nameM = document.getElementById('name-male').value || "Jimmy";
            const nameF = document.getElementById('name-female').value || "Linda";
            
            const factM = document.getElementById('fact-male').value;
            const feelM = document.getElementById('feel-male').value;
            const factF = document.getElementById('fact-female').value;
            const feelF = document.getElementById('feel-female').value;

            if((!factM && !feelM) || (!factF && !feelF)) {
                alert("è¯·è‡³å°‘å¡«å†™ä¸€äº›å†…å®¹ï¼ŒçŒ«çŒ«æ— æ³•å®¡åˆ¤ç©ºæ°”ï¼ğŸ±");
                return;
            }

            // æ˜¾ç¤º Loading
            document.getElementById('view-loading').classList.remove('hidden');
            const logEl = document.getElementById('ai-log');
            
            // æ„å»º Prompt
            const systemPrompt = `ä½ æ˜¯ä¸€åªåå«â€œçŒ«çŒ«å¤§æ³•å®˜â€çš„AIï¼Œè´Ÿè´£è°ƒè§£æƒ…ä¾£åµæ¶ã€‚ä½ çš„æ€§æ ¼æ˜¯ï¼šå¯çˆ±ã€å¹½é»˜ã€ä¸€é’ˆè§è¡€ã€ç¨å¾®æœ‰ç‚¹æ¯’èˆŒä½†å¿ƒåœ°å–„è‰¯ã€‚
            
            è¯·åˆ†æä»¥ä¸‹æƒ…ä¾£çš„äº‰åµå†…å®¹ï¼š
            ç”·æ–¹ (${nameM})ï¼š
            - äº‹å®ï¼š${factM}
            - å§”å±ˆï¼š${feelM}
            
            å¥³æ–¹ (${nameF})ï¼š
            - äº‹å®ï¼š${factF}
            - å§”å±ˆï¼š${feelF}

            è¯·ä»¥ JSON æ ¼å¼è¿”å›ç»“æœï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
            1. "title": ä¸€ä¸ªå¥½ç¬‘çš„æ¡ˆä»¶æ ‡é¢˜ï¼ˆå¦‚â€œè–¯ç‰‡ç‹¬é£Ÿå¼•å‘çš„è¡€æ¡ˆâ€ï¼‰ã€‚
            2. "score_male": ç”·æ–¹è´£ä»»ç™¾åˆ†æ¯”ï¼ˆæ•´æ•°ï¼‰ã€‚
            3. "score_female": å¥³æ–¹è´£ä»»ç™¾åˆ†æ¯”ï¼ˆæ•´æ•°ï¼Œä¸¤è€…ç›¸åŠ 100ï¼‰ã€‚
            4. "analysis": ä¸€æ®µæ·±åº¦çš„åˆ†æï¼Œåˆ†æåŒæ–¹çš„å¿ƒç†ï¼ŒæŒ‡å‡ºé€»è¾‘æ¼æ´ï¼Œç”¨å¹½é»˜çš„å£å»ã€‚
            5. "tasks": ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«3ä¸ªå…·ä½“çš„ã€å¥½ç©çš„å’Œè§£ä»»åŠ¡ï¼ˆå¦‚â€œç»™å¯¹æ–¹æŒ‰æ‘©5åˆ†é’Ÿâ€ï¼‰ã€‚
            
            åªè¿”å›çº¯ JSON å­—ç¬¦ä¸²ï¼Œä¸è¦Markdownæ ¼å¼ã€‚`;

            try {
                logEl.innerText = "> æ­£åœ¨åŠ å¯†å‘é€è‡³ DeepSeek...";
                
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {"role": "system", "content": "You are a helpful assistant that outputs JSON."},
                            {"role": "user", "content": systemPrompt}
                        ],
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                logEl.innerText = "> æ¥æ”¶å–µæ˜Ÿä¿¡å·ä¸­...";
                const data = await response.json();
                
                // è§£æå†…å®¹
                let content = data.choices[0].message.content;
                // æ¸…ç†å¯èƒ½å­˜åœ¨çš„ markdown ä»£ç å—æ ‡è®°
                content = content.replace(/```json/g, "").replace(/```/g, "").trim();
                
                const result = JSON.parse(content);
                renderResult(result, nameM, nameF);

            } catch (error) {
                console.error(error);
                logEl.innerText = "> ç½‘ç»œæ‹¥å µï¼Œå¯ç”¨å¤‡ç”¨çŒ«ç²®...";
                // é™çº§ç­–ç•¥ï¼šå¦‚æœ API å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°éšæœºç”Ÿæˆ
                setTimeout(() => {
                    useOfflineFallback(nameM, nameF);
                }, 1500);
            }
        }

        function renderResult(data, nameM, nameF) {
            // éšè— Loading
            document.getElementById('view-loading').classList.add('hidden');
            
            // å¡«å……æ•°æ®
            document.getElementById('result-title').innerText = data.title;
            document.getElementById('label-male').innerText = nameM;
            document.getElementById('label-female').innerText = nameF;
            
            // è¿›åº¦æ¡åŠ¨ç”»
            setTimeout(() => {
                document.getElementById('bar-male').style.width = data.score_male + "%";
                document.getElementById('bar-male').innerText = data.score_male + "%";
                document.getElementById('bar-female').style.width = data.score_female + "%";
                document.getElementById('bar-female').innerText = data.score_female + "%";
            }, 100);

            // æ¸²æŸ“ Markdown åˆ†æ
            document.getElementById('result-analysis').innerHTML = marked.parse(data.analysis);

            // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
            const tasksHtml = data.tasks.map((task, i) => `
                <li class="flex items-start gap-3 bg-white p-3 rounded-xl border border-yellow-200">
                    <span class="bg-yellow-400 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">${i+1}</span>
                    <span class="text-gray-700 text-sm">${task}</span>
                </li>
            `).join('');
            document.getElementById('result-tasks').innerHTML = tasksHtml;

            // åˆ‡æ¢è§†å›¾
            switchView('view-result');
        }

        // === ç¦»çº¿é™çº§é€»è¾‘ (API æŒ‚äº†ä¹Ÿèƒ½ç”¨) ===
        function useOfflineFallback(nameM, nameF) {
            const mockData = {
                title: "ç¥ç§˜çš„é€šè®¯æ•…éšœæ¡ˆ",
                score_male: 60,
                score_female: 40,
                analysis: "è™½ç„¶æœ¬å–µè¿æ¥ DeepSeek æ˜Ÿçƒå¤±è´¥ï¼ˆå¯èƒ½æ˜¯è¢«å¤–æ˜ŸäººåŠ«æŒäº†ï¼‰ï¼Œä½†å‡­å€Ÿæœ¬å®˜çš„ç›´è§‰ï¼šç”·æ–¹é€»è¾‘å¤ªç›´ï¼Œå¥³æ–¹å¿ƒæ€å¤ªç»†ã€‚ä¸€ä¸ªåœ¨è®²é“ç†ï¼Œä¸€ä¸ªåœ¨è®²æ€åº¦ï¼Œè¿™æ ¹æœ¬å°±æ˜¯è·¨æœèŠå¤©å˜›ï¼",
                tasks: [
                    `${nameM} å¿…é¡»ç«‹åˆ»å¤¸ ${nameF} ä¸‰å¥ï¼Œä¸å‡†é‡å¤ã€‚`,
                    "åŒæ–¹äº’ç›¸æè„¸ 10 ç§’é’Ÿã€‚",
                    "ä¸€èµ·å»åƒé¡¿å¥½çš„ï¼Œè¿™é¡¿è°é”™è°è¯·å®¢ï¼ˆå»ºè®®AAï¼‰ã€‚"
                ]
            };
            renderResult(mockData, nameM, nameF);
        }

        // === æ¸©åº¦è®¡é€»è¾‘ ===
        let currentHeat = 30;
        function addHeat(val) {
            currentHeat += val;
            if(currentHeat > 100) currentHeat = 100;

            const liquid = document.getElementById('liquid');
            const tempVal = document.getElementById('temp-val');

            liquid.style.height = currentHeat + "%";
            tempVal.innerText = currentHeat + "Â°C";

            if(currentHeat < 50) {
                liquid.className = "w-full bg-blue-400 transition-all duration-700 relative";
                tempVal.className = "text-5xl font-black text-blue-400 cute-font mb-6 transition-colors";
            } else if (currentHeat < 90) {
                liquid.className = "w-full bg-pink-400 transition-all duration-700 relative";
                tempVal.className = "text-5xl font-black text-pink-400 cute-font mb-6 transition-colors";
            } else {
                liquid.className = "w-full bg-red-500 transition-all duration-700 relative";
                tempVal.className = "text-5xl font-black text-red-500 cute-font mb-6 transition-colors animate-bounce";
                triggerConfetti();
            }
        }

        function triggerConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#F472B6', '#FBBF24', '#60A5FA']
            });
        }

        // === è®¾ç½®é¢æ¿ ===
        function toggleSettings() {
            document.getElementById('settings-panel').classList.toggle('hidden');
        }
        
        // åˆå§‹åŒ– Key
        document.getElementById('api-key-input').value = DEEPSEEK_API_KEY;

        function saveSettings() {
            const newKey = document.getElementById('api-key-input').value;
            if(newKey) {
                DEEPSEEK_API_KEY = newKey;
                alert("API Key å·²æ›´æ–°ï¼");
                toggleSettings();
            }
        }
    </script>
</body>
</html>