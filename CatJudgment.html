<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI çŒ«çŒ«æ³•åº­ | ç»ˆæå®¡åˆ¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- åŸºç¡€è®¾å®š --- */
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #FFF0F5;
            background-image: radial-gradient(#FBCFE8 2px, transparent 2px), radial-gradient(#F472B6 1px, transparent 1px);
            background-size: 30px 30px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden; /* é˜²æ­¢æ•´ä¸ªé¡µé¢æ»šåŠ¨ */
            user-select: none;
        }
        .cute-font { font-family: 'ZCOOL KuaiLe', cursive; }

        /* --- ç»ç’ƒæ‹Ÿæ€ --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 15px 40px -10px rgba(255, 105, 180, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        /* --- SVG çŒ«çŒ«åŠ¨ç”» --- */
        .cat-svg { width: 180px; height: 180px; overflow: visible; }
        .cat-head { animation: floatHead 3s ease-in-out infinite; transform-origin: center bottom; }
        .cat-eye { animation: blink 4s infinite; transform-origin: center; }
        .cat-tail { animation: wagTail 2s ease-in-out infinite alternate; transform-origin: bottom left; }
        
        @keyframes floatHead { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(5px) rotate(2deg); } }
        @keyframes blink { 0%, 96%, 98% { transform: scaleY(1); } 97% { transform: scaleY(0.1); } }
        @keyframes wagTail { 0% { transform: rotate(-10deg); } 100% { transform: rotate(10deg); } }

        /* --- æŠ•å–‚åŠ¨ç”» --- */
        .fish-item {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            animation: flyToMouth 0.8s forwards ease-in;
            z-index: 50;
        }
        @keyframes flyToMouth {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0.5); opacity: 0; }
        }

        /* --- éšè—æ»šåŠ¨æ¡ --- */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full md:max-w-4xl glass-panel rounded-3xl relative h-[85vh] md:h-[750px] flex flex-col overflow-hidden transition-all duration-300">
        
        <!-- é¡¶éƒ¨æ  (å›ºå®š) -->
        <header class="bg-gradient-to-r from-pink-50 to-purple-50 p-3 px-5 border-b border-pink-100 flex justify-between items-center z-50 shrink-0">
            <button id="btn-back" onclick="goBack()" class="hidden text-gray-500 hover:text-pink-500 text-sm font-bold flex items-center gap-1">
                <i class="fa-solid fa-chevron-left"></i> è¿”å›
            </button>
            <h1 class="text-xl md:text-2xl text-pink-500 cute-font tracking-widest flex items-center gap-2 flex-1 justify-center">
                <i class="fa-solid fa-scale-balanced"></i> AI çŒ«çŒ«æ³•åº­
            </h1>
            <button onclick="toggleSettings()" class="text-gray-400 hover:text-pink-500 p-2"><i class="fa-solid fa-gear"></i></button>
        </header>

        <!-- API è®¾ç½® -->
        <div id="settings-panel" class="hidden absolute top-14 left-4 right-4 z-[60] bg-white/95 p-4 rounded-xl shadow-2xl border border-pink-200 backdrop-blur-md">
            <h3 class="text-sm font-bold text-gray-700 mb-2">DeepSeek API Key</h3>
            <input type="password" id="api-key-input" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-2 text-sm mb-3 outline-none focus:ring-2 ring-pink-300 font-mono">
            <div class="flex justify-end gap-2">
                <button onclick="toggleSettings()" class="text-xs text-gray-500 px-3">å–æ¶ˆ</button>
                <button onclick="saveSettings()" class="bg-pink-500 text-white px-3 py-1 rounded-md text-xs font-bold">ä¿å­˜</button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 relative w-full h-full overflow-hidden">

            <!-- 1. é¦–é¡µ -->
            <div id="view-landing" class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 overflow-y-auto no-scrollbar transition-transform duration-500">
                <div class="relative mb-4 mt-2 group cursor-pointer" id="cat-container">
                    <div class="absolute -inset-6 bg-pink-200 rounded-full blur-2xl opacity-30 animate-pulse"></div>
                    <svg class="cat-svg relative z-10" viewBox="0 0 200 200">
                        <path class="cat-tail" d="M140 160 Q 170 140 160 110 T 150 80" fill="none" stroke="#F472B6" stroke-width="12" stroke-linecap="round"/>
                        <ellipse cx="100" cy="160" rx="60" ry="45" fill="#FCE7F3" />
                        <g class="cat-head">
                            <circle cx="100" cy="100" r="50" fill="#FFF0F5" stroke="#F472B6" stroke-width="3"/>
                            <path d="M60 70 L 50 30 L 90 60 Z" fill="#FBCFE8" stroke="#F472B6" stroke-width="2"/>
                            <path d="M140 70 L 150 30 L 110 60 Z" fill="#FBCFE8" stroke="#F472B6" stroke-width="2"/>
                            <circle class="cat-eye" cx="80" cy="95" r="5" fill="#374151"/>
                            <circle class="cat-eye" cx="120" cy="95" r="5" fill="#374151"/>
                            <path d="M95 110 L 105 110 L 100 115 Z" fill="#F472B6"/>
                            <path d="M100 115 Q 90 125 80 115 M 100 115 Q 110 125 120 115" fill="none" stroke="#374151" stroke-width="2"/>
                            <circle cx="70" cy="110" r="6" fill="#FDA4AF" opacity="0.6"/>
                            <circle cx="130" cy="110" r="6" fill="#FDA4AF" opacity="0.6"/>
                            <path d="M60 60 Q 100 20 140 60" fill="none" stroke="#E5E7EB" stroke-width="15" stroke-linecap="round"/>
                            <path d="M50 70 Q 40 90 50 110" fill="none" stroke="#E5E7EB" stroke-width="8" stroke-linecap="round"/>
                            <path d="M150 70 Q 160 90 150 110" fill="none" stroke="#E5E7EB" stroke-width="8" stroke-linecap="round"/>
                        </g>
                        <g transform="translate(140, 130) rotate(-20)">
                            <rect x="0" y="0" width="10" height="40" fill="#92400E" rx="2"/>
                            <rect x="-15" y="0" width="40" height="15" fill="#B45309" rx="2"/>
                        </g>
                    </svg>
                    <div id="bribe-counter" class="absolute -top-4 -right-4 bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-[10px] font-bold shadow-md transform scale-0 transition-transform">
                        å·²è´¿èµ‚: <span>0</span>
                    </div>
                </div>

                <div class="mb-8 flex gap-3 justify-center w-full">
                    <button onclick="feedCat(event)" class="bg-white border-2 border-orange-200 text-orange-500 px-4 py-2 rounded-full text-xs font-bold shadow-sm hover:bg-orange-50 active:scale-95 transition flex items-center gap-1">
                        <i class="fa-solid fa-fish"></i> æŠ•å–‚è´¿èµ‚
                    </button>
                    <button onclick="fakeUpload()" class="bg-white border-2 border-blue-200 text-blue-500 px-4 py-2 rounded-full text-xs font-bold shadow-sm hover:bg-blue-50 active:scale-95 transition flex items-center gap-1">
                        <i class="fa-regular fa-image"></i> ä¸Šä¼ èŠå¤©è®°å½•
                    </button>
                </div>

                <h2 class="text-3xl cute-font text-gray-800 mb-2">è°çš„é”…ï¼ŸAI æ¥èƒŒï¼</h2>
                <p class="text-gray-400 text-xs md:text-sm mb-6 max-w-xs leading-relaxed">
                    æœ¬æ³•åº­ç”± DeepSeek å¤§è„‘é©±åŠ¨ã€‚<br>ç»å¯¹å…¬æ­£ï¼Œé™¤éä½ ç»™çš„é±¼å¹²å¤Ÿå¤š (å¼€ç©ç¬‘)ã€‚
                </p>

                <button onclick="switchView('view-form')" class="w-full md:w-auto px-16 py-4 bg-gray-900 text-white rounded-2xl font-bold text-lg shadow-xl hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-2 group">
                    <i class="fa-solid fa-gavel text-pink-400 group-hover:rotate-12 transition"></i> å‡å ‚å¼€åº­
                </button>
            </div>

            <!-- 2. è¡¨å•é¡µ -->
            <div id="view-form" class="absolute inset-0 flex flex-col translate-x-full transition-transform duration-500 bg-white/60">
                
                <!-- å¯æ»šåŠ¨åŒºåŸŸ -->
                <div class="flex-1 overflow-y-auto no-scrollbar p-4 md:p-6 pb-4">
                    <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar shrink-0 py-1">
                        <button onclick="fillCase('snack')" class="whitespace-nowrap bg-white border border-pink-200 text-pink-500 px-3 py-1 rounded-full text-xs font-bold shadow-sm">ğŸ¿ é›¶é£Ÿç‹¬é£Ÿ</button>
                        <button onclick="fillCase('photo')" class="whitespace-nowrap bg-white border border-blue-200 text-blue-500 px-3 py-1 rounded-full text-xs font-bold shadow-sm">ğŸ“¸ æ­»äº¡æ‹ç…§</button>
                        <button onclick="fillCase('game')" class="whitespace-nowrap bg-white border border-purple-200 text-purple-500 px-3 py-1 rounded-full text-xs font-bold shadow-sm">ğŸ® æ¸¸æˆå¤±è¸ª</button>
                    </div>

                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1 bg-white p-4 rounded-2xl shadow-sm border border-blue-50 hover:border-blue-200 transition">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-8 h-8 rounded-lg bg-blue-100 text-blue-500 flex items-center justify-center font-bold">J</span>
                                <input id="name-male" type="text" value="Jimmy" class="font-bold text-gray-700 w-full outline-none bg-transparent" placeholder="ç”·ç”Ÿåå­—">
                            </div>
                            <textarea id="fact-male" class="w-full h-16 p-2 bg-blue-50/30 rounded-lg text-sm mb-2 outline-none resize-none placeholder-gray-400 focus:bg-blue-50" placeholder="äº‹å®: å‘ç”Ÿäº†ä»€ä¹ˆ?"></textarea>
                            <textarea id="feel-male" class="w-full h-16 p-2 bg-blue-50/30 rounded-lg text-sm outline-none resize-none placeholder-gray-400 focus:bg-blue-50" placeholder="å§”å±ˆ: å¿ƒé‡Œæ€ä¹ˆæƒ³?"></textarea>
                        </div>

                        <div class="flex-1 bg-white p-4 rounded-2xl shadow-sm border border-pink-50 hover:border-pink-200 transition">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-8 h-8 rounded-lg bg-pink-100 text-pink-500 flex items-center justify-center font-bold">L</span>
                                <input id="name-female" type="text" value="Linda" class="font-bold text-gray-700 w-full outline-none bg-transparent" placeholder="å¥³ç”Ÿåå­—">
                            </div>
                            <textarea id="fact-female" class="w-full h-16 p-2 bg-pink-50/30 rounded-lg text-sm mb-2 outline-none resize-none placeholder-gray-400 focus:bg-pink-50" placeholder="äº‹å®: å‘ç”Ÿäº†ä»€ä¹ˆ?"></textarea>
                            <textarea id="feel-female" class="w-full h-16 p-2 bg-pink-50/30 rounded-lg text-sm outline-none resize-none placeholder-gray-400 focus:bg-pink-50" placeholder="å§”å±ˆ: å¿ƒé‡Œæ€ä¹ˆæƒ³?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨å›ºå®šæŒ‰é’®åŒº (Flexå¸ƒå±€ï¼Œç‰©ç†éš”ç¦»ï¼Œç»ä¸é®æŒ¡) -->
                <div class="shrink-0 p-4 bg-gradient-to-t from-white via-white/90 to-transparent pt-2 z-20">
                    <button onclick="submitToAI()" class="w-full py-3.5 bg-gradient-to-r from-gray-800 to-black text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform">
                        <span>æäº¤ç»™æ³•å®˜</span> <i class="fa-solid fa-paper-plane text-xs text-pink-300"></i>
                    </button>
                </div>
            </div>

            <!-- 3. Loading -->
            <div id="view-loading" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white/95 z-50 p-8 text-center backdrop-blur-md">
                <div class="relative w-20 h-20 mb-6">
                    <div class="absolute w-full h-full border-4 border-gray-100 rounded-full"></div>
                    <div class="absolute w-full h-full border-4 border-pink-500 border-t-transparent rounded-full animate-spin"></div>
                    <i class="fa-solid fa-paw absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-2xl text-pink-300 animate-pulse"></i>
                </div>
                <h3 class="text-xl cute-font text-gray-800 mb-2">DeepSeek æ­£åœ¨ç¿»é˜…å·å®—...</h3>
                <div id="ai-log" class="text-[10px] text-gray-400 bg-gray-50 px-3 py-1 rounded-full border border-gray-100 font-mono">
                    > æ­£åœ¨è¿æ¥å–µæ˜ŸæœåŠ¡å™¨...
                </div>
            </div>

            <!-- 4. ç»“æœé¡µ (é‡ç‚¹ä¿®æ­£åŒºåŸŸ) -->
            <div id="view-result" class="absolute inset-0 flex flex-col translate-x-full transition-transform duration-500 bg-white/50">
                
                <!-- ä¸Šéƒ¨åˆ†ï¼šå¯æ»šåŠ¨çš„å†…å®¹åŒº (flex-1 è‡ªåŠ¨æ’‘å¼€å‰©ä½™ç©ºé—´) -->
                <div class="flex-1 overflow-y-auto no-scrollbar p-4 md:p-6">
                    <div class="text-center mb-4">
                        <h2 id="result-title" class="text-2xl cute-font text-gray-800 leading-tight drop-shadow-sm">...</h2>
                    </div>

                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-white mb-4">
                        <div class="flex justify-between items-end mb-2 px-1">
                            <span class="text-xs font-bold text-gray-500" id="label-male">Jimmy</span>
                            <span class="text-[10px] text-pink-400 bg-pink-50 px-2 rounded border border-pink-100">ğŸ“Š è´£ä»»æŒ‡æ•°</span>
                            <span class="text-xs font-bold text-gray-500" id="label-female">Linda</span>
                        </div>
                        <div class="relative h-10 w-full bg-gray-100 rounded-full overflow-hidden flex font-bold text-white text-sm">
                            <div id="bar-male" class="flex items-center justify-center transition-all duration-1000 w-[50%]"><span>50%</span></div>
                            <div id="bar-female" class="flex items-center justify-center transition-all duration-1000 w-[50%]"><span>50%</span></div>
                            <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-full w-8 h-8 flex items-center justify-center text-gray-300 border-2 border-gray-50 z-10 text-[10px] font-black">VS</div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-white/80 p-4 rounded-xl border border-pink-50 shadow-sm relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-1 h-full bg-pink-400"></div>
                            <h3 class="text-sm font-bold text-pink-600 mb-2"><i class="fa-solid fa-cat"></i> å–µæ˜Ÿåˆ¤è¯</h3>
                            <div id="result-analysis" class="text-sm text-gray-600 leading-6 text-justify"></div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 shadow-sm">
                            <h3 class="text-sm font-bold text-yellow-700 mb-2"><i class="fa-solid fa-list-ul"></i> å¼ºåˆ¶å’Œè§£æ¸…å•</h3>
                            <div id="result-tasks" class="space-y-2"></div>
                        </div>

                        <button onclick="generateCopy()" class="w-full py-2 border-2 border-dashed border-gray-300 text-gray-400 rounded-xl text-xs font-bold hover:border-pink-300 hover:text-pink-500 transition flex items-center justify-center gap-1">
                            <i class="fa-regular fa-copy"></i> ä¸€é”®ç”Ÿæˆã€Šç»™å¯¹è±¡çš„è®¤é”™/è°…è§£ä¹¦ã€‹
                        </button>
                        
                        <!-- åº•éƒ¨åŠ ä¸€ç‚¹ç©ºdivå ä½ï¼Œç¡®ä¿æ»šåˆ°åº•éƒ¨ä¸è´´è¾¹ -->
                        <div class="h-4"></div>
                    </div>
                </div>

                <!-- ä¸‹éƒ¨åˆ†ï¼šå›ºå®šæŒ‰é’®åŒº (ç‰©ç†éš”ç¦»ï¼Œç»ä¸é®æŒ¡) -->
                <div class="shrink-0 p-4 pt-2 bg-gradient-to-t from-white via-white/95 to-transparent z-20">
                    <button onclick="switchView('view-restore')" class="w-full py-3 bg-pink-500 text-white rounded-xl font-bold shadow-lg hover:bg-pink-600 active:scale-95 transition-all">
                        æ¥å—åˆ¤å†³ & å»å’Œå¥½ <i class="fa-solid fa-heart ml-1"></i>
                    </button>
                </div>
            </div>

            <!-- 5. ä¿®å¤é¡µ -->
            <div id="view-restore" class="absolute inset-0 flex flex-col items-center justify-center p-6 translate-x-full transition-transform duration-500 bg-white/90">
                <h2 class="text-2xl cute-font text-gray-800 mb-1">ğŸ’– çˆ±æƒ…å›æ¸©ä»ª</h2>
                <p class="text-gray-400 text-xs mb-8">åšç‚¹ä»»åŠ¡ï¼Œè®©æ¸©åº¦å‡èµ·æ¥ï¼</p>
                <div class="relative w-20 h-56 bg-gray-100 rounded-full border-4 border-white shadow-inner flex flex-col justify-end overflow-hidden mb-6">
                    <div id="liquid" class="w-full bg-blue-400 transition-all duration-700 relative" style="height: 30%"></div>
                    <div class="absolute w-full h-px bg-gray-300 top-1/4 opacity-50"></div>
                    <div class="absolute w-full h-px bg-gray-300 top-2/4 opacity-50"></div>
                    <div class="absolute w-full h-px bg-gray-300 top-3/4 opacity-50"></div>
                </div>
                <div id="temp-val" class="text-4xl font-black text-blue-400 cute-font mb-8">30Â°C</div>
                <div class="grid grid-cols-2 gap-3 w-full">
                    <button onclick="addHeat(20)" class="bg-white border p-3 rounded-xl text-xs font-bold text-gray-600 active:scale-95">ğŸ¥¤ è¯·å–å¥¶èŒ¶</button>
                    <button onclick="addHeat(30)" class="bg-white border p-3 rounded-xl text-xs font-bold text-gray-600 active:scale-95">ğŸ¤ æ¡æ‰‹è¨€å’Œ</button>
                    <button onclick="addHeat(40)" class="col-span-2 bg-pink-50 border border-pink-200 p-3 rounded-xl text-xs font-bold text-pink-600 active:scale-95">ğŸ˜˜ äº²äº²æŠ±æŠ± (å¤§æ‹›)</button>
                </div>
                <button onclick="resetApp()" class="mt-8 text-gray-400 text-xs underline">å†åˆ¤ä¸€ä¸ª</button>
            </div>

        </main>
    </div>

    <!-- é€»è¾‘è„šæœ¬ -->
    <script>
        // === é…ç½® ===
        let DEEPSEEK_API_KEY = "sk-9bc8bb993b684218803e58cdeac07d12"; 
        const API_URL = "https://api.deepseek.com/chat/completions";

        // === 1. æŠ•å–‚åŠŸèƒ½ ===
        let bribeCount = 0;
        function feedCat(e) {
            bribeCount++;
            const counter = document.getElementById('bribe-counter');
            counter.style.transform = 'scale(1)';
            counter.querySelector('span').innerText = bribeCount;

            const fish = document.createElement('div');
            fish.innerHTML = '<i class="fa-solid fa-fish text-orange-400"></i>';
            fish.className = 'fish-item';
            const btnRect = e.target.getBoundingClientRect();
            fish.style.left = (btnRect.left + btnRect.width/2) + 'px';
            fish.style.top = (btnRect.top) + 'px';
            const catRect = document.getElementById('cat-container').getBoundingClientRect();
            const targetX = (catRect.left + catRect.width/2) - parseFloat(fish.style.left);
            const targetY = (catRect.top + catRect.height/2) - parseFloat(fish.style.top);
            fish.style.setProperty('--tx', `${targetX}px`);
            fish.style.setProperty('--ty', `${targetY}px`);
            document.body.appendChild(fish);
            setTimeout(() => fish.remove(), 800);

            if(bribeCount === 5) alert("çŒ«çŒ«æ‚„æ‚„å‘Šè¯‰ä½ ï¼šç»™å¾—å¤šï¼Œåˆ¤å¾—è½»ï¼ˆå‡çš„ï¼‰ğŸ¤«");
        }

        // === 2. ä¿®æ­£ç‰ˆï¼šå‡ä¸Šä¼  (å‚²å¨‡æ–‡æ¡ˆ) ===
        function fakeUpload() {
            alert("ğŸ± å–µå‘œï¼Ÿ\nè¯¥åŠŸèƒ½æš‚æœªå¼€æ”¾ï¼ï¼ï¼\né™¤é...ä½ ç°åœ¨å°±å»ç‚¹æ—è¾¹çš„ã€ŒæŠ•å–‚è´¿èµ‚ã€å¤šç»™æˆ‘å‡ æ¡å°é±¼å¹²ï¼ğŸŸ");
        }

        // === 3. ä¿®æ­£ç‰ˆï¼šå¤åˆ¶æ–‡æ¡ˆ (å¸¦å…¼å®¹æ€§ä¿®å¤) ===
        function generateCopy() {
            const nm = document.getElementById('name-male').value || "Jimmy";
            const nf = document.getElementById('name-female').value || "Linda";
            const text = `ã€çŒ«çŒ«æ³•åº­åˆ¤å†³ä¹¦ã€‘\nç»è¿‡ AI å¤§æ³•å®˜å®¡ç†ï¼Œå…³äº ${nm} å’Œ ${nf} çš„æ¡ˆä»¶å·²æœ‰å®šè®ºã€‚ä¸ºäº†ç»´æŠ¤ä¸–ç•Œå’Œå¹³ï¼Œæˆ‘å†³å®šæ‰§è¡Œåˆ¤å†³ï¼šäº²äº²æŠ±æŠ±ä¸¾é«˜é«˜ï¼\n(æœ¬åˆ¤å†³ä¸ºç»ˆå®¡åˆ¤å†³ï¼Œç«‹å³æ‰§è¡Œ)`;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    alert("âœ… æ–‡æ¡ˆå·²å¤åˆ¶ï¼å¿«å»å‘ç»™ TAï¼ğŸ“±");
                }).catch(err => {
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                var successful = document.execCommand('copy');
                var msg = successful ? 'âœ… æ–‡æ¡ˆå·²å¤åˆ¶ï¼å¿«å»å‘ç»™ TAï¼ğŸ“±' : 'âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æˆªå›¾ã€‚';
                alert(msg);
            } catch (err) {
                alert('âŒ æ— æ³•å¤åˆ¶ï¼Œè¯·æ‰‹åŠ¨æˆªå›¾ã€‚');
            }
            document.body.removeChild(textArea);
        }

        // === è§†å›¾å¯¼èˆª ===
        function switchView(viewId) {
            const views = ['view-landing', 'view-form', 'view-result', 'view-restore'];
            const btnBack = document.getElementById('btn-back');
            views.forEach(id => {
                const el = document.getElementById(id);
                if(id === viewId) el.style.transform = 'translateX(0)';
                else el.style.transform = 'translateX(100%)';
            });
            if(viewId === 'view-landing') {
                document.getElementById('view-form').style.transform = 'translateX(100%)';
                btnBack.classList.add('hidden');
            } else {
                document.getElementById('view-landing').style.transform = 'translateX(-100%)';
                if(viewId !== 'view-restore') btnBack.classList.remove('hidden');
            }
        }
        function goBack() { switchView('view-landing'); }

        // === é¢„è®¾å¡«å…… ===
        const presets = {
            snack: { j_f: "ä¹°äº†ä¸€åŒ…è–¯ç‰‡è‡ªå·±åƒå®Œäº†ã€‚", j_e: "å¤ªé¥¿äº†æ²¡å¿ä½ï¼Œå¹³æ—¶ä¹Ÿæ²¡å°‘ç»™å¥¹ä¹°å•Šã€‚", l_f: "ä»–åƒç‹¬é£Ÿï¼Œä¸€å£æ²¡ç•™ã€‚", l_e: "ä¸æ˜¯è–¯ç‰‡çš„é—®é¢˜ï¼Œæ˜¯å¿ƒé‡Œæ²¡æˆ‘ã€‚" },
            photo: { j_f: "æ‹äº†50å¼ éƒ½ä¸æ»¡æ„ã€‚", j_e: "æˆ‘è§‰å¾—æŒºçœŸå®çš„ï¼Œå¥¹éè¦ä¿®å›¾ã€‚", l_f: "æ‹å¾—åƒä¸€ç±³äº”ï¼Œå…¨æ˜¯æ­»è§’ã€‚", l_e: "å®Œå…¨åœ¨æ•·è¡ï¼Œæ ¹æœ¬ä¸ç”¨å¿ƒã€‚" },
            game: { j_f: "å›¢æˆ˜æ²¡å›æ¶ˆæ¯ã€‚", j_e: "æ¸¸æˆä¸èƒ½æš‚åœå•Šï¼", l_f: "å¤±è¸ªä¸¤å°æ—¶ä¸å›ã€‚", l_e: "æ‰‹æœºåœ¨æ‰‹è¾¹éƒ½ä¸å›ï¼Œå†·æš´åŠ›ã€‚" }
        };
        function fillCase(t) {
            const d = presets[t];
            document.getElementById('fact-male').value = d.j_f;
            document.getElementById('feel-male').value = d.j_e;
            document.getElementById('fact-female').value = d.l_f;
            document.getElementById('feel-female').value = d.l_e;
        }

        // === API æäº¤ ===
        async function submitToAI() {
            const nm = document.getElementById('name-male').value || "Jimmy";
            const nf = document.getElementById('name-female').value || "Linda";
            const fm = document.getElementById('fact-male').value;
            const em = document.getElementById('feel-male').value;
            const ff = document.getElementById('fact-female').value;
            const ef = document.getElementById('feel-female').value;

            if((!fm && !em) || (!ff && !ef)) { alert("çŒ«çŒ«æ— æ³•å®¡åˆ¤ç©ºæ°”ï¼ğŸ˜¿"); return; }

            document.getElementById('view-loading').classList.remove('hidden');
            const log = document.getElementById('ai-log');
            
            const prompt = `ä½ æ˜¯ä¸€åªå¯çˆ±æ¯’èˆŒçš„çŒ«çŒ«æ³•å®˜ã€‚åˆ†ææƒ…ä¾£åµæ¶ï¼š
            ç”·æ–¹(${nm}): äº‹å®[${fm}], å§”å±ˆ[${em}]ã€‚
            å¥³æ–¹(${nf}): äº‹å®[${ff}], å§”å±ˆ[${ef}]ã€‚
            è¿”å›JSON(æ— markdown):
            1. title: æœ‰è¶£æ ‡é¢˜
            2. score_male: ç”·æ–¹è´£ä»»(0-100)
            3. score_female: å¥³æ–¹è´£ä»»(åˆè®¡100)
            4. analysis: å¹½é»˜åˆ†æ
            5. tasks: 3ä¸ªå’Œè§£ä»»åŠ¡`;

            try {
                log.innerText = "> å‘é€è‡³ DeepSeek...";
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${DEEPSEEK_API_KEY}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{role:"system", content:"Output JSON only."}, {role:"user", content:prompt}],
                        stream: false
                    })
                });
                if(!res.ok) throw new Error("API Error");
                const data = await res.json();
                let content = data.choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();
                renderResult(JSON.parse(content), nm, nf);
            } catch(e) {
                console.error(e);
                log.innerText = "> ç½‘ç»œæ‹¥å µï¼Œå¯ç”¨æœ¬åœ°å‰§æœ¬...";
                setTimeout(() => useOffline(nm, nf), 1500);
            }
        }

        function renderResult(data, nm, nf) {
            document.getElementById('view-loading').classList.add('hidden');
            document.getElementById('result-title').innerText = data.title;
            
            document.getElementById('label-male').innerText = nm;
            document.getElementById('label-female').innerText = nf;

            const sm = data.score_male;
            const sf = data.score_female;
            
            const bm = document.getElementById('bar-male');
            bm.style.width = sm + "%";
            bm.className = `flex items-center justify-center transition-all duration-1000 ${sm>50?'bg-red-400':'bg-blue-400'}`;
            bm.innerHTML = `<span>${sm}%</span>`;

            const bf = document.getElementById('bar-female');
            bf.style.width = sf + "%";
            bf.className = `flex items-center justify-center transition-all duration-1000 ${sf>50?'bg-red-400':'bg-blue-400'}`;
            bf.innerHTML = `<span>${sf}%</span>`;

            document.getElementById('result-analysis').innerHTML = marked.parse(data.analysis);
            
            document.getElementById('result-tasks').innerHTML = data.tasks.map((t,i)=>`
                <div class="flex gap-3 bg-white p-2 rounded-lg border border-yellow-50">
                    <span class="bg-yellow-400 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold shrink-0 mt-0.5">${i+1}</span>
                    <span class="text-xs text-gray-600">${t}</span>
                </div>
            `).join('');

            switchView('view-result');
        }

        function useOffline(nm, nf) {
            renderResult({
                title: "ä¿¡å·ä¸¢å¤±çš„ç½—ç”Ÿé—¨",
                score_male: 50, score_female: 50,
                analysis: "çŒ«çŒ«ä¸æ¯æ˜Ÿå¤±è”ï¼æš‚åˆ¤å¹³å±€ã€‚å…¬è¯´å…¬æœ‰ç†ï¼Œå©†è¯´å©†æœ‰ç†ï¼Œå»ºè®®äº²äº²è§£å†³ã€‚",
                tasks: ["å‘ä¸ªè¡¨æƒ…åŒ…ã€‚", "æ¡æ‰‹è¨€å’Œã€‚", "è°å…ˆç¬‘è°è¯·å®¢ã€‚"]
            }, nm, nf);
        }

        // === æ¸©åº¦è®¡ ===
        let heat = 30;
        function addHeat(val) {
            heat = Math.min(100, heat + val);
            const l = document.getElementById('liquid');
            const t = document.getElementById('temp-val');
            l.style.height = heat + "%";
            t.innerText = heat + "Â°C";
            
            if(heat < 60) { l.className="w-full bg-blue-400 transition-all duration-700 relative"; t.className="text-4xl font-black text-blue-400 cute-font mb-8 transition-colors"; }
            else if(heat < 90) { l.className="w-full bg-pink-400 transition-all duration-700 relative"; t.className="text-4xl font-black text-pink-400 cute-font mb-8 transition-colors"; }
            else { l.className="w-full bg-red-500 transition-all duration-700 relative"; t.className="text-4xl font-black text-red-500 cute-font mb-8 transition-colors animate-bounce"; confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); }
        }

        function resetApp() {
            heat = 30;
            document.getElementById('liquid').style.height = "30%";
            document.getElementById('liquid').className = "w-full bg-blue-400 transition-all duration-700 relative";
            document.getElementById('temp-val').innerText = "30Â°C";
            document.getElementById('fact-male').value=""; document.getElementById('feel-male').value="";
            document.getElementById('fact-female').value=""; document.getElementById('feel-female').value="";
            bribeCount = 0; document.getElementById('bribe-counter').style.transform = 'scale(0)';
            switchView('view-landing');
        }

        // === è®¾ç½® ===
        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); document.getElementById('api-key-input').value = DEEPSEEK_API_KEY; }
        function saveSettings() { const v=document.getElementById('api-key-input').value; if(v){DEEPSEEK_API_KEY=v; alert('Key Updated'); toggleSettings();} }
    </script>
</body>
</html>
